var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.arrayIteratorImpl=function(a){var c=0;return function(){return c<a.length?{done:!1,value:a[c++]}:{done:!0}}};$jscomp.arrayIterator=function(a){return{next:$jscomp.arrayIteratorImpl(a)}};$jscomp.makeIterator=function(a){var c="undefined"!=typeof Symbol&&Symbol.iterator&&a[Symbol.iterator];return c?c.call(a):$jscomp.arrayIterator(a)};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;
$jscomp.ISOLATE_POLYFILLS=!1;$jscomp.FORCE_POLYFILL_PROMISE=!1;$jscomp.FORCE_POLYFILL_PROMISE_WHEN_NO_UNHANDLED_REJECTION=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(a,c,d){if(a==Array.prototype||a==Object.prototype)return a;a[c]=d.value;return a};
$jscomp.getGlobal=function(a){a=["object"==typeof globalThis&&globalThis,a,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global];for(var c=0;c<a.length;++c){var d=a[c];if(d&&d.Math==Math)return d}throw Error("Cannot find global object");};$jscomp.global=$jscomp.getGlobal(this);$jscomp.IS_SYMBOL_NATIVE="function"===typeof Symbol&&"symbol"===typeof Symbol("x");$jscomp.TRUST_ES6_POLYFILLS=!$jscomp.ISOLATE_POLYFILLS||$jscomp.IS_SYMBOL_NATIVE;$jscomp.polyfills={};
$jscomp.propertyToPolyfillSymbol={};$jscomp.POLYFILL_PREFIX="$jscp$";var $jscomp$lookupPolyfilledValue=function(a,c){var d=$jscomp.propertyToPolyfillSymbol[c];if(null==d)return a[c];d=a[d];return void 0!==d?d:a[c]};$jscomp.polyfill=function(a,c,d,e){c&&($jscomp.ISOLATE_POLYFILLS?$jscomp.polyfillIsolated(a,c,d,e):$jscomp.polyfillUnisolated(a,c,d,e))};
$jscomp.polyfillUnisolated=function(a,c,d,e){d=$jscomp.global;a=a.split(".");for(e=0;e<a.length-1;e++){var f=a[e];if(!(f in d))return;d=d[f]}a=a[a.length-1];e=d[a];c=c(e);c!=e&&null!=c&&$jscomp.defineProperty(d,a,{configurable:!0,writable:!0,value:c})};
$jscomp.polyfillIsolated=function(a,c,d,e){var f=a.split(".");a=1===f.length;e=f[0];e=!a&&e in $jscomp.polyfills?$jscomp.polyfills:$jscomp.global;for(var q=0;q<f.length-1;q++){var v=f[q];if(!(v in e))return;e=e[v]}f=f[f.length-1];d=$jscomp.IS_SYMBOL_NATIVE&&"es6"===d?e[f]:null;c=c(d);null!=c&&(a?$jscomp.defineProperty($jscomp.polyfills,f,{configurable:!0,writable:!0,value:c}):c!==d&&(void 0===$jscomp.propertyToPolyfillSymbol[f]&&($jscomp.propertyToPolyfillSymbol[f]=$jscomp.IS_SYMBOL_NATIVE?$jscomp.global.Symbol(f):
$jscomp.POLYFILL_PREFIX+f),f=$jscomp.propertyToPolyfillSymbol[f],$jscomp.defineProperty(e,f,{configurable:!0,writable:!0,value:c})))};$jscomp.polyfill("Object.is",function(a){return a?a:function(c,d){return c===d?0!==c||1/c===1/d:c!==c&&d!==d}},"es6","es3");
$jscomp.polyfill("Array.prototype.includes",function(a){return a?a:function(c,d){var e=this;e instanceof String&&(e=String(e));var f=e.length;d=d||0;for(0>d&&(d=Math.max(d+f,0));d<f;d++){var q=e[d];if(q===c||Object.is(q,c))return!0}return!1}},"es7","es3");
$jscomp.checkStringArgs=function(a,c,d){if(null==a)throw new TypeError("The 'this' value for String.prototype."+d+" must not be null or undefined");if(c instanceof RegExp)throw new TypeError("First argument to String.prototype."+d+" must not be a regular expression");return a+""};$jscomp.polyfill("String.prototype.includes",function(a){return a?a:function(c,d){return-1!==$jscomp.checkStringArgs(this,c,"includes").indexOf(c,d||0)}},"es6","es3");var SetStateDirty,SetStateClean,SyncFs;
(function(){function a(b,g,r){b.preventDefault();b=$jscomp.makeIterator(b.changedTouches);for(var k=b.next();!k.done;k=b.next()){k=k.value;for(var t=k.identifier,u=0;u<l.length;u++)if(r&&null===l[u]&&(l[u]=t),l[u]===t){var E=h.getBoundingClientRect();g(u,(k.clientX-E.x)/n,1-(k.clientY-E.y)/p);if(r)return}}}function c(){J()}function d(b){for(var g=0;g<l.length;g++)if(null!==l[g]){for(var r=!1,k=$jscomp.makeIterator(b.touches),t=k.next();!t.done;t=k.next())if(l[g]===t.value.identifier){r=!0;break}r||
(C(g,0,0),l[g]=null)}a(b,K,!0)}function e(b){a(b,function(g,r,k){C(g,r,k);l[g]=null})}function f(b){a(b,L)}function q(){M(m[0],m[1],m[2])&1&&window.open(URL.createObjectURL(new Blob([N()])));window.requestAnimationFrame(q)}function v(){h.style.setProperty("display","none");document.body.classList.add("center");y.value=z?"Resume Game":"Start Game";y.style.setProperty("display","block")}function O(){y.style.setProperty("display","none");h.style.setProperty("display","block");document.body.classList.remove("center");
A=!1;if(window.DeviceMotionEvent)if(DeviceMotionEvent.requestPermission){var b=DeviceMotionEvent.requestPermission();b?(b.then(function(g){"denied"===g?console.error('Can\'t access accelerometer: "denied" returned from DeviceMotionEvent.requestPermission.'):A=!0;w()}),b.catch(function(g){console.error("Can't access accelerometer: exception caught by DeviceMotionEvent.requestPermission: "+g);w()})):(console.error("Can't access accelerometer: DeviceMotionEvent.requestPermission returned "+b),w())}else console.warn("DeviceMotionEvent.requestPermission is "+
DeviceMotionEvent.requestPermission+", assuming accelerometer can can be accessed."),A=!0,w();else console.error("Can't access accelerometer: window.DeviceMotionEvent is "+window.DeviceMotionEvent),w()}function w(){if(document.documentElement.requestFullscreen){var b=document.documentElement.requestFullscreen();b?b.then(P):x("Can't go fullscreen: document.documentElement.requestFullscreen returned "+b)}else x("Can't go fullscreen: not supported by browser.")}function P(){if(window.screen&&screen.orientation){var b=
screen.orientation.lock("landscape-primary");b?(b.then(Q),b.catch(function(g){x("Can't lock screen orientation: exception caught by screen.orientation.lock: "+g)})):x("Can't lock screen orientation: screen.orientation.lock returned "+b)}else x("Can't lock screen orientation: not supported by browser.")}function x(b){console.error(b);n=window.innerWidth;p=window.innerHeight;z||F()}function Q(){n=screen.width;p=screen.height;h.width=n;h.height=p;z||F()}function F(){window.addEventListener("devicemotion",
function(b){b=b.accelerationIncludingGravity;m[0]=b.x;m[1]=b.y;m[2]=b.z;G&&(m[0]=-m[0],m[1]=-m[1],m[2]=-m[2])});h.addEventListener("touchstart",d,{passive:!1});h.addEventListener("touchend",e,{passive:!1});h.addEventListener("touchmove",f,{passive:!1});R()}function R(){z=!0;h.width=n;h.height=p;FS.mkdir("/data");FS.mount(IDBFS,{},"/data");FS.syncfs(!0,function(b){b?console.error(b):(S(!1,A,H(),n,p),window.requestAnimationFrame(q))})}function H(){if(0!=B)return B;if(window.screen&&screen.orientation)switch(screen.orientation.angle){case 0:return 1;
case 90:return 2;case 180:return 3;case 270:return 4;default:return console.error("Invalid orientation angle:",screen.orientation.angle),0}else switch(window.orientation){case 0:return 1;case 90:return 2;case 180:return 3;case -90:return 4;default:return console.error("Invalid orientation angle:",window.orientation),0}}function D(){if(0!=B){var b=Math.min(window.innerWidth,window.innerHeight),g=b/1.5;B&1?(n=b,p=g):(n=g,p=b)}else n=window.innerWidth,p=window.innerHeight;h.width=n;h.height=p;T(H(),
n,p)}function U(){for(var b=0;b<l.length;b++)null!==l[b]&&(C(b,0,0),l[b]=null);v()}var h=document.getElementById("canvas");GLctx=h.getContext("webgl",{alpha:!1});var y=document.getElementById("start-button"),I=document.getElementById("error-msg"),S=Module.cwrap("Init",null,["number","number","number","number","number"]),M=Module.cwrap("Step","number",["number","number","number"]),J=Module.cwrap("SaveStateToInitLoaded"),T=Module.cwrap("SetViewport",null,["number","number","number"]),K=Module.cwrap("TouchDown",
null,["number","number","number"]),C=Module.cwrap("TouchUp",null,["number","number","number"]),L=Module.cwrap("TouchMove",null,["number","number","number"]),N=Module.cwrap("EditorData","string"),G=!1,A=!0,B=0,n=window.innerWidth,p=window.innerHeight,z=!1,l=[null,null],m=[0,1,0];SyncFs=function(){FS.syncfs(function(b){b?console.error(b):SetStateClean()})};SetStateDirty=function(){window.addEventListener("beforeunload",c)};SetStateClean=function(){window.removeEventListener("beforeunload",c)};Module.doNotCaptureKeyboard=
!0;Module.onRuntimeInitialized=function(){window.addEventListener("resize",D);window.screen&&screen.orientation?screen.orientation.addEventListener("change",D):window.addEventListener("orientationchange",D);var b=!0;try{document.createEvent("TouchEvent")}catch(r){b=!1}var g=navigator.userAgent;G=g.includes("Safari")&&!g.includes("Chrome");b?(y.addEventListener("click",O),document.addEventListener("visibilitychange",U),v()):(console.error("Touch input not supported on device."),I.textContent="Touch input not supported on device.",
h.style.setProperty("display","none"),I.style.setProperty("display","block"))}})();
